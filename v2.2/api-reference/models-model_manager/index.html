
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Zamba is a command-line tool built in Python to automatically identify the species seen in camera trap videos from sites in central Africa.">
      
      
      
        <link rel="canonical" href="https://zamba.drivendata.org/docs/v2.2/api-reference/models-model_manager/">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-8.5.7">
    
    
      
        <title>zamba.models.model_manager - Zamba</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.20d9efc8.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
      <link rel="stylesheet" href="../../stylesheets/custom_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#zambamodelsmodel_manager" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-component="outdated" hidden>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Zamba" class="md-header__button md-logo" aria-label="Zamba" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Zamba
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              zamba.models.model_manager
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/drivendataorg/zamba" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Zamba" class="md-nav__button md-logo" aria-label="Zamba" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Zamba
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/drivendataorg/zamba" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2">
          Getting started
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Getting started" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Getting started
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../install/" class="md-nav__link">
        Installing zamba
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../quickstart/" class="md-nav__link">
        Quickstart
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3">
          User Tutorials
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="User Tutorials" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          User Tutorials
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../predict-tutorial/" class="md-nav__link">
        Classifying unlabeled videos
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../train-tutorial/" class="md-nav__link">
        Training a model on labeled videos
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../debugging/" class="md-nav__link">
        Debugging
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../extra-options/" class="md-nav__link">
        Guide to common optional parameters
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4">
          Available Models
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Available Models" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Available Models
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../models/species-detection/" class="md-nav__link">
        Species detection
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../models/densepose/" class="md-nav__link">
        DensePose
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../models/td-full-metrics/" class="md-nav__link">
        African species performance
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5">
          Advanced Options
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Advanced Options" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Advanced Options
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../configurations/" class="md-nav__link">
        All configuration options
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../yaml-config/" class="md-nav__link">
        Using YAML configuration files
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../contribute/">Contribute to zamba</a>
          
        </div>
      
      <nav class="md-nav" aria-label="Contribute to zamba" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Contribute to zamba
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      
      
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../changelog/">Changelog</a>
          
        </div>
      
      <nav class="md-nav" aria-label="Changelog" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Changelog
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" checked>
      
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_8">
          API Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="API Reference" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          API Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_1" type="checkbox" id="__nav_8_1" >
      
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_8_1">
          zamba.data
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="zamba.data" data-md-level="2">
        <label class="md-nav__title" for="__nav_8_1">
          <span class="md-nav__icon md-icon"></span>
          zamba.data
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../data-metadata/" class="md-nav__link">
        zamba.data.metadata
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../data-video/" class="md-nav__link">
        zamba.data.video
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_2" type="checkbox" id="__nav_8_2" checked>
      
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_8_2">
          zamba.models
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="zamba.models" data-md-level="2">
        <label class="md-nav__title" for="__nav_8_2">
          <span class="md-nav__icon md-icon"></span>
          zamba.models
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../models-config/" class="md-nav__link">
        zamba.models.config
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_2_2" type="checkbox" id="__nav_8_2_2" >
      
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_8_2_2">
          zamba.models.densepose
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="zamba.models.densepose" data-md-level="3">
        <label class="md-nav__title" for="__nav_8_2_2">
          <span class="md-nav__icon md-icon"></span>
          zamba.models.densepose
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../densepose_config/" class="md-nav__link">
        zamba.models.densepose.config
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../densepose_manager/" class="md-nav__link">
        zamba.models.densepose.densepose_manager
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../models-efficientnet_models/" class="md-nav__link">
        zamba.models.efficientnet_models
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          zamba.models.model_manager
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        zamba.models.model_manager
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#zamba.models.model_manager-attributes" class="md-nav__link">
    Attributes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#zamba.models.model_manager-classes" class="md-nav__link">
    Classes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#zamba.models.model_manager-functions" class="md-nav__link">
    Functions
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../models-slowfast_models/" class="md-nav__link">
        zamba.models.slowfast_models
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../models-utils/" class="md-nav__link">
        zamba.models.utils
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_3" type="checkbox" id="__nav_8_3" >
      
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_8_3">
          zamba.object_detection
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="zamba.object_detection" data-md-level="2">
        <label class="md-nav__title" for="__nav_8_3">
          <span class="md-nav__icon md-icon"></span>
          zamba.object_detection
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../object-detection-megadetector_lite_yolox/" class="md-nav__link">
        zamba.object_detection.yolox.megadetector_lite_yolox
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_4" type="checkbox" id="__nav_8_4" >
      
      
      
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_8_4">
          zamba.pytorch
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="zamba.pytorch" data-md-level="2">
        <label class="md-nav__title" for="__nav_8_4">
          <span class="md-nav__icon md-icon"></span>
          zamba.pytorch
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../pytorch-dataloaders/" class="md-nav__link">
        zamba.pytorch.dataloaders
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../pytorch-finetuning/" class="md-nav__link">
        zamba.pytorch.finetuning
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../pytorch-layers/" class="md-nav__link">
        zamba.pytorch.layers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../pytorch-transforms/" class="md-nav__link">
        zamba.pytorch.transforms
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../pytorch-utils/" class="md-nav__link">
        zamba.pytorch.utils
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_5" type="checkbox" id="__nav_8_5" >
      
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_8_5">
          zamba.pytorch_lightning
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="zamba.pytorch_lightning" data-md-level="2">
        <label class="md-nav__title" for="__nav_8_5">
          <span class="md-nav__icon md-icon"></span>
          zamba.pytorch_lightning
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../pytorch_lightning-utils/" class="md-nav__link">
        zamba.pytorch_lightning.utils
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../exceptions/" class="md-nav__link">
        zamba.exceptions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../metrics/" class="md-nav__link">
        zamba.metrics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../settings/" class="md-nav__link">
        zamba.settings
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#zamba.models.model_manager-attributes" class="md-nav__link">
    Attributes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#zamba.models.model_manager-classes" class="md-nav__link">
    Classes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#zamba.models.model_manager-functions" class="md-nav__link">
    Functions
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  <a href="https://github.com/drivendataorg/zamba/edit/master/docs/api-reference/models-model_manager.md" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>


<h1 id="zambamodelsmodel_manager">zamba.models.model_manager<a class="headerlink" href="#zambamodelsmodel_manager" title="Permanent link">&para;</a></h1>


<div class="doc doc-object doc-module">



  <div class="doc doc-contents first">

  

  <div class="doc doc-children">





<h2 id="zamba.models.model_manager-attributes">Attributes<a href="#zamba.models.model_manager-attributes" class="headerlink" title="Permanent link">&para;</a></h2>
<h2 id="zamba.models.model_manager-classes">Classes<a href="#zamba.models.model_manager-classes" class="headerlink" title="Permanent link">&para;</a></h2>

<div class="doc doc-object doc-class">



<h3 id="zamba.models.model_manager.ModelManager" class="doc doc-heading">
        <code>ModelManager</code>


<a href="#zamba.models.model_manager.ModelManager" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code>object</code></p>

  
      <p>Mediates loading, configuration, and logic of model calls.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>config</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="zamba.models.config.ModelConfig" href="../models-config/#zamba.models.config.ModelConfig">ModelConfig</a></code>
          </td>
          <td><p>Instantiated ModelConfig.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>


        <details class="quote">
          <summary>Source code in <code>zamba/models/model_manager.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ModelManager</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Mediates loading, configuration, and logic of model calls.</span>

<span class="sd">    Args:</span>
<span class="sd">        config (ModelConfig): Instantiated ModelConfig.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">ModelConfig</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_yaml</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">ModelConfig</span><span class="p">):</span>
            <span class="n">config</span> <span class="o">=</span> <span class="n">ModelConfig</span><span class="o">.</span><span class="n">parse_file</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">train_model</span><span class="p">(</span>
            <span class="n">train_config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">train_config</span><span class="p">,</span>
            <span class="n">video_loader_config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">video_loader_config</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">predict_model</span><span class="p">(</span>
            <span class="n">predict_config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">predict_config</span><span class="p">,</span>
            <span class="n">video_loader_config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">video_loader_config</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">





<h4 id="zamba.models.model_manager.ModelManager-attributes">Attributes<a href="#zamba.models.model_manager.ModelManager-attributes" class="headerlink" title="Permanent link">&para;</a></h4>

<div class="doc doc-object doc-attribute">



<h5 id="zamba.models.model_manager.ModelManager.config" class="doc doc-heading">
<code class="highlight language-python"><span class="n">config</span> <span class="o">=</span> <span class="n">config</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#zamba.models.model_manager.ModelManager.config" class="headerlink" title="Permanent link">&para;</a></h5>


  <div class="doc doc-contents ">
  </div>

</div>

<h4 id="zamba.models.model_manager.ModelManager-functions">Functions<a href="#zamba.models.model_manager.ModelManager-functions" class="headerlink" title="Permanent link">&para;</a></h4>

<div class="doc doc-object doc-function">



<h5 id="zamba.models.model_manager.ModelManager.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">:</span> <span class="n">ModelConfig</span><span class="p">)</span></code>

<a href="#zamba.models.model_manager.ModelManager.__init__" class="headerlink" title="Permanent link">&para;</a></h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>zamba/models/model_manager.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">434</span>
<span class="normal">435</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">ModelConfig</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="zamba.models.model_manager.ModelManager.from_yaml" class="doc doc-heading">
<code class="highlight language-python"><span class="n">from_yaml</span><span class="p">(</span><span class="n">config</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#zamba.models.model_manager.ModelManager.from_yaml" class="headerlink" title="Permanent link">&para;</a></h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>zamba/models/model_manager.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_yaml</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">ModelConfig</span><span class="p">):</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">ModelConfig</span><span class="o">.</span><span class="n">parse_file</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="zamba.models.model_manager.ModelManager.predict" class="doc doc-heading">
<code class="highlight language-python"><span class="n">predict</span><span class="p">()</span></code>

<a href="#zamba.models.model_manager.ModelManager.predict" class="headerlink" title="Permanent link">&para;</a></h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>zamba/models/model_manager.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">predict_model</span><span class="p">(</span>
        <span class="n">predict_config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">predict_config</span><span class="p">,</span>
        <span class="n">video_loader_config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">video_loader_config</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="zamba.models.model_manager.ModelManager.train" class="doc doc-heading">
<code class="highlight language-python"><span class="n">train</span><span class="p">()</span></code>

<a href="#zamba.models.model_manager.ModelManager.train" class="headerlink" title="Permanent link">&para;</a></h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>zamba/models/model_manager.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">train_model</span><span class="p">(</span>
        <span class="n">train_config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">train_config</span><span class="p">,</span>
        <span class="n">video_loader_config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">video_loader_config</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>
<h2 id="zamba.models.model_manager-functions">Functions<a href="#zamba.models.model_manager-functions" class="headerlink" title="Permanent link">&para;</a></h2>

<div class="doc doc-object doc-function">



<h3 id="zamba.models.model_manager.instantiate_model" class="doc doc-heading">
<code class="highlight language-python"><span class="n">instantiate_model</span><span class="p">(</span><span class="n">checkpoint</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">,</span> <span class="n">labels</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">scheduler_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SchedulerConfig</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">from_scratch</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">model_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ModelEnum</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">use_default_model_labels</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ZambaVideoClassificationLightningModule</span></code>

<a href="#zamba.models.model_manager.instantiate_model" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Instantiates the model from a checkpoint and detects whether the model head should be replaced.
The model head is replaced if labels contain species that are not on the model or use_default_model_labels=False.</p>
<p>Supports model instantiation for the following cases:
- train from scratch (from_scratch=True)
- finetune with new species (from_scratch=False, labels contains different species than model)
- finetune with a subset of zamba species and output only the species in the labels file (use_default_model_labels=False)
- finetune with a subset of zamba species but output all zamba species (use_default_model_labels=True)
- predict using pretrained model (labels=None)</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>checkpoint</code></td>
          <td>
                <code>path</code>
          </td>
          <td><p>Path to a checkpoint on disk.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>labels</code></td>
          <td>
                <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td><p>Dataframe where filepath is the index and columns are one hot encoded species.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>scheduler_config</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="zamba.models.config.SchedulerConfig" href="../models-config/#zamba.models.config.SchedulerConfig">SchedulerConfig</a></code>
          </td>
          <td><p>SchedulerConfig to use for training or finetuning.
Only used if labels is not None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>from_scratch</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Whether to instantiate the model with base weights. This means starting
from the imagenet weights for image based models and the Kinetics weights for video models.
Only used if labels is not None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>model_name</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="zamba.models.config.ModelEnum" href="../models-config/#zamba.models.config.ModelEnum">ModelEnum</a></code>
          </td>
          <td><p>Model name used to look up default hparams used for that model.
Only relevant if training from scratch.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>use_default_model_labels(bool,</code></td>
          <td>
                <code>optional</code>
          </td>
          <td><p>Whether to output the full set of default model labels rather than
just the species in the labels file. Only used if labels is not None.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>ZambaVideoClassificationLightningModule</code></td>          <td>
                <code><a class="autorefs autorefs-internal" title="zamba.pytorch_lightning.utils.ZambaVideoClassificationLightningModule" href="../pytorch_lightning-utils/#zamba.pytorch_lightning.utils.ZambaVideoClassificationLightningModule">ZambaVideoClassificationLightningModule</a></code>
          </td>
          <td><p>Instantiated model</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>zamba/models/model_manager.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">instantiate_model</span><span class="p">(</span>
    <span class="n">checkpoint</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">,</span>
    <span class="n">labels</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">scheduler_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SchedulerConfig</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">from_scratch</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">model_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ModelEnum</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">use_default_model_labels</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ZambaVideoClassificationLightningModule</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Instantiates the model from a checkpoint and detects whether the model head should be replaced.</span>
<span class="sd">    The model head is replaced if labels contain species that are not on the model or use_default_model_labels=False.</span>

<span class="sd">    Supports model instantiation for the following cases:</span>
<span class="sd">    - train from scratch (from_scratch=True)</span>
<span class="sd">    - finetune with new species (from_scratch=False, labels contains different species than model)</span>
<span class="sd">    - finetune with a subset of zamba species and output only the species in the labels file (use_default_model_labels=False)</span>
<span class="sd">    - finetune with a subset of zamba species but output all zamba species (use_default_model_labels=True)</span>
<span class="sd">    - predict using pretrained model (labels=None)</span>

<span class="sd">    Args:</span>
<span class="sd">        checkpoint (path): Path to a checkpoint on disk.</span>
<span class="sd">        labels (pd.DataFrame, optional): Dataframe where filepath is the index and columns are one hot encoded species.</span>
<span class="sd">        scheduler_config (SchedulerConfig, optional): SchedulerConfig to use for training or finetuning.</span>
<span class="sd">            Only used if labels is not None.</span>
<span class="sd">        from_scratch (bool, optional): Whether to instantiate the model with base weights. This means starting</span>
<span class="sd">            from the imagenet weights for image based models and the Kinetics weights for video models.</span>
<span class="sd">           Only used if labels is not None.</span>
<span class="sd">        model_name (ModelEnum, optional): Model name used to look up default hparams used for that model.</span>
<span class="sd">            Only relevant if training from scratch.</span>
<span class="sd">        use_default_model_labels(bool, optional): Whether to output the full set of default model labels rather than</span>
<span class="sd">            just the species in the labels file. Only used if labels is not None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        ZambaVideoClassificationLightningModule: Instantiated model</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">from_scratch</span><span class="p">:</span>
        <span class="n">hparams</span> <span class="o">=</span> <span class="n">get_default_hparams</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">hparams</span> <span class="o">=</span> <span class="n">get_checkpoint_hparams</span><span class="p">(</span><span class="n">checkpoint</span><span class="p">)</span>

    <span class="n">model_class</span> <span class="o">=</span> <span class="n">available_models</span><span class="p">[</span><span class="n">hparams</span><span class="p">[</span><span class="s2">&quot;model_class&quot;</span><span class="p">]]</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Instantiating model: </span><span class="si">{</span><span class="n">model_class</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># predicting</span>
    <span class="k">if</span> <span class="n">labels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># predict; load from checkpoint uses associated hparams</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Loading from checkpoint.&quot;</span><span class="p">)</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">model_class</span><span class="o">.</span><span class="n">load_from_checkpoint</span><span class="p">(</span><span class="n">checkpoint_path</span><span class="o">=</span><span class="n">checkpoint</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">model</span>

    <span class="c1"># get species from labels file</span>
    <span class="n">species</span> <span class="o">=</span> <span class="n">labels</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;^species_&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">species</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;species_&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">species</span><span class="p">]</span>

    <span class="c1"># train from scratch</span>
    <span class="k">if</span> <span class="n">from_scratch</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Training from scratch.&quot;</span><span class="p">)</span>

        <span class="c1"># default would use scheduler used for pretrained model</span>
        <span class="k">if</span> <span class="n">scheduler_config</span> <span class="o">!=</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span>
            <span class="n">hparams</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">scheduler_config</span><span class="o">.</span><span class="n">dict</span><span class="p">())</span>

        <span class="n">hparams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;species&quot;</span><span class="p">:</span> <span class="n">species</span><span class="p">})</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">model_class</span><span class="p">(</span><span class="o">**</span><span class="n">hparams</span><span class="p">)</span>
        <span class="n">log_schedulers</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">model</span>

    <span class="c1"># determine if finetuning or resuming training</span>

    <span class="c1"># check if species in label file are a subset of pretrained model species</span>
    <span class="n">is_subset</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">species</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">hparams</span><span class="p">[</span><span class="s2">&quot;species&quot;</span><span class="p">]))</span>

    <span class="k">if</span> <span class="n">is_subset</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">use_default_model_labels</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">resume_training</span><span class="p">(</span>
                <span class="n">scheduler_config</span><span class="o">=</span><span class="n">scheduler_config</span><span class="p">,</span>
                <span class="n">hparams</span><span class="o">=</span><span class="n">hparams</span><span class="p">,</span>
                <span class="n">species</span><span class="o">=</span><span class="n">species</span><span class="p">,</span>
                <span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">,</span>
                <span class="n">checkpoint</span><span class="o">=</span><span class="n">checkpoint</span><span class="p">,</span>
                <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Limiting only to species in labels file. Replacing model head and finetuning.&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">replace_head</span><span class="p">(</span>
                <span class="n">scheduler_config</span><span class="o">=</span><span class="n">scheduler_config</span><span class="p">,</span>
                <span class="n">hparams</span><span class="o">=</span><span class="n">hparams</span><span class="p">,</span>
                <span class="n">species</span><span class="o">=</span><span class="n">species</span><span class="p">,</span>
                <span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">,</span>
                <span class="n">checkpoint</span><span class="o">=</span><span class="n">checkpoint</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="c1"># without a subset, you will always get a new head</span>
    <span class="c1"># the config validation prohibits setting use_default_model_labels to True without a subset</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;Provided species do not fully overlap with Zamba species. Replacing model head and finetuning.&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">replace_head</span><span class="p">(</span>
            <span class="n">scheduler_config</span><span class="o">=</span><span class="n">scheduler_config</span><span class="p">,</span>
            <span class="n">hparams</span><span class="o">=</span><span class="n">hparams</span><span class="p">,</span>
            <span class="n">species</span><span class="o">=</span><span class="n">species</span><span class="p">,</span>
            <span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">,</span>
            <span class="n">checkpoint</span><span class="o">=</span><span class="n">checkpoint</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="zamba.models.model_manager.log_schedulers" class="doc doc-heading">
<code class="highlight language-python"><span class="n">log_schedulers</span><span class="p">(</span><span class="n">model</span><span class="p">)</span></code>

<a href="#zamba.models.model_manager.log_schedulers" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>zamba/models/model_manager.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">log_schedulers</span><span class="p">(</span><span class="n">model</span><span class="p">):</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using learning rate scheduler: </span><span class="si">{</span><span class="n">model</span><span class="o">.</span><span class="n">hparams</span><span class="p">[</span><span class="s1">&#39;scheduler&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using scheduler params: </span><span class="si">{</span><span class="n">model</span><span class="o">.</span><span class="n">hparams</span><span class="p">[</span><span class="s1">&#39;scheduler_params&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="zamba.models.model_manager.predict_model" class="doc doc-heading">
<code class="highlight language-python"><span class="n">predict_model</span><span class="p">(</span><span class="n">predict_config</span><span class="p">:</span> <span class="n">PredictConfig</span><span class="p">,</span> <span class="n">video_loader_config</span><span class="p">:</span> <span class="n">VideoLoaderConfig</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span></code>

<a href="#zamba.models.model_manager.predict_model" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Predicts from a model and writes out predictions to a csv.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>predict_config</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="zamba.models.config.PredictConfig" href="../models-config/#zamba.models.config.PredictConfig">PredictConfig</a></code>
          </td>
          <td><p>Pydantic config for performing inference.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>video_loader_config</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="zamba.data.video.VideoLoaderConfig" href="../data-video/#zamba.data.video.VideoLoaderConfig">VideoLoaderConfig</a></code>
          </td>
          <td><p>Pydantic config for preprocessing videos.
If None, will use default for model specified in PredictConfig.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>zamba/models/model_manager.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">predict_model</span><span class="p">(</span>
    <span class="n">predict_config</span><span class="p">:</span> <span class="n">PredictConfig</span><span class="p">,</span>
    <span class="n">video_loader_config</span><span class="p">:</span> <span class="n">VideoLoaderConfig</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Predicts from a model and writes out predictions to a csv.</span>

<span class="sd">    Args:</span>
<span class="sd">        predict_config (PredictConfig): Pydantic config for performing inference.</span>
<span class="sd">        video_loader_config (VideoLoaderConfig, optional): Pydantic config for preprocessing videos.</span>
<span class="sd">            If None, will use default for model specified in PredictConfig.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># get default VLC for model if not specified</span>
    <span class="k">if</span> <span class="n">video_loader_config</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">video_loader_config</span> <span class="o">=</span> <span class="n">ModelConfig</span><span class="p">(</span>
            <span class="n">predict_config</span><span class="o">=</span><span class="n">predict_config</span><span class="p">,</span> <span class="n">video_loader_config</span><span class="o">=</span><span class="n">video_loader_config</span>
        <span class="p">)</span><span class="o">.</span><span class="n">video_loader_config</span>

    <span class="c1"># set up model</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">instantiate_model</span><span class="p">(</span>
        <span class="n">checkpoint</span><span class="o">=</span><span class="n">predict_config</span><span class="o">.</span><span class="n">checkpoint</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">data_module</span> <span class="o">=</span> <span class="n">ZambaDataModule</span><span class="p">(</span>
        <span class="n">video_loader_config</span><span class="o">=</span><span class="n">video_loader_config</span><span class="p">,</span>
        <span class="n">transform</span><span class="o">=</span><span class="n">MODEL_MAPPING</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">][</span><span class="s2">&quot;transform&quot;</span><span class="p">],</span>
        <span class="n">predict_metadata</span><span class="o">=</span><span class="n">predict_config</span><span class="o">.</span><span class="n">filepaths</span><span class="p">,</span>
        <span class="n">batch_size</span><span class="o">=</span><span class="n">predict_config</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span>
        <span class="n">num_workers</span><span class="o">=</span><span class="n">predict_config</span><span class="o">.</span><span class="n">num_workers</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">validate_species</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data_module</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">video_loader_config</span><span class="o">.</span><span class="n">cache_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No cache dir is specified. Videos will not be cached.&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Videos will be cached to </span><span class="si">{</span><span class="n">video_loader_config</span><span class="o">.</span><span class="n">cache_dir</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

    <span class="n">trainer</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">Trainer</span><span class="p">(</span>
        <span class="n">gpus</span><span class="o">=</span><span class="n">predict_config</span><span class="o">.</span><span class="n">gpus</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fast_dev_run</span><span class="o">=</span><span class="n">predict_config</span><span class="o">.</span><span class="n">dry_run</span>
    <span class="p">)</span>

    <span class="n">configuration</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;model_class&quot;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">model_class</span><span class="p">,</span>
        <span class="s2">&quot;species&quot;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="p">,</span>
        <span class="s2">&quot;predict_config&quot;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">predict_config</span><span class="o">.</span><span class="n">json</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;filepaths&quot;</span><span class="p">})),</span>
        <span class="s2">&quot;inference_start_time&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
        <span class="s2">&quot;video_loader_config&quot;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">video_loader_config</span><span class="o">.</span><span class="n">json</span><span class="p">()),</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="n">predict_config</span><span class="o">.</span><span class="n">save</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>

        <span class="n">config_path</span> <span class="o">=</span> <span class="n">predict_config</span><span class="o">.</span><span class="n">save_dir</span> <span class="o">/</span> <span class="s2">&quot;predict_configuration.yaml&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Writing out full configuration to </span><span class="si">{</span><span class="n">config_path</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">config_path</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">configuration</span><span class="p">,</span> <span class="n">fp</span><span class="p">)</span>

    <span class="n">dataloader</span> <span class="o">=</span> <span class="n">data_module</span><span class="o">.</span><span class="n">predict_dataloader</span><span class="p">()</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting prediction...&quot;</span><span class="p">)</span>
    <span class="n">probas</span> <span class="o">=</span> <span class="n">trainer</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">dataloaders</span><span class="o">=</span><span class="n">dataloader</span><span class="p">)</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">probas</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">dataloader</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">original_indices</span>
    <span class="p">)</span>

    <span class="c1"># change output format if specified</span>
    <span class="k">if</span> <span class="n">predict_config</span><span class="o">.</span><span class="n">proba_threshold</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span> <span class="o">&gt;</span> <span class="n">predict_config</span><span class="o">.</span><span class="n">proba_threshold</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">predict_config</span><span class="o">.</span><span class="n">output_class_names</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">idxmax</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>  <span class="c1"># round to a useful number of places</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">predict_config</span><span class="o">.</span><span class="n">save</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>

        <span class="n">preds_path</span> <span class="o">=</span> <span class="n">predict_config</span><span class="o">.</span><span class="n">save_dir</span> <span class="o">/</span> <span class="s2">&quot;zamba_predictions.csv&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saving out predictions to </span><span class="si">{</span><span class="n">preds_path</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">preds_path</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="zamba.models.model_manager.replace_head" class="doc doc-heading">
<code class="highlight language-python"><span class="n">replace_head</span><span class="p">(</span><span class="n">scheduler_config</span><span class="p">,</span> <span class="n">hparams</span><span class="p">,</span> <span class="n">species</span><span class="p">,</span> <span class="n">model_class</span><span class="p">,</span> <span class="n">checkpoint</span><span class="p">)</span></code>

<a href="#zamba.models.model_manager.replace_head" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>zamba/models/model_manager.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">replace_head</span><span class="p">(</span><span class="n">scheduler_config</span><span class="p">,</span> <span class="n">hparams</span><span class="p">,</span> <span class="n">species</span><span class="p">,</span> <span class="n">model_class</span><span class="p">,</span> <span class="n">checkpoint</span><span class="p">):</span>
    <span class="c1"># update in case we want to finetune with different scheduler</span>
    <span class="k">if</span> <span class="n">scheduler_config</span> <span class="o">!=</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span>
        <span class="n">hparams</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">scheduler_config</span><span class="o">.</span><span class="n">dict</span><span class="p">())</span>

    <span class="n">hparams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;species&quot;</span><span class="p">:</span> <span class="n">species</span><span class="p">})</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">model_class</span><span class="p">(</span><span class="n">finetune_from</span><span class="o">=</span><span class="n">checkpoint</span><span class="p">,</span> <span class="o">**</span><span class="n">hparams</span><span class="p">)</span>
    <span class="n">log_schedulers</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">model</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="zamba.models.model_manager.resume_training" class="doc doc-heading">
<code class="highlight language-python"><span class="n">resume_training</span><span class="p">(</span><span class="n">scheduler_config</span><span class="p">,</span> <span class="n">hparams</span><span class="p">,</span> <span class="n">species</span><span class="p">,</span> <span class="n">model_class</span><span class="p">,</span> <span class="n">checkpoint</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span></code>

<a href="#zamba.models.model_manager.resume_training" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>zamba/models/model_manager.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">resume_training</span><span class="p">(</span>
    <span class="n">scheduler_config</span><span class="p">,</span>
    <span class="n">hparams</span><span class="p">,</span>
    <span class="n">species</span><span class="p">,</span>
    <span class="n">model_class</span><span class="p">,</span>
    <span class="n">checkpoint</span><span class="p">,</span>
    <span class="n">labels</span><span class="p">,</span>
<span class="p">):</span>
    <span class="c1"># resume training; add additional species columns to labels file if needed</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="s2">&quot;Provided species fully overlap with Zamba species. Resuming training from latest checkpoint.&quot;</span>
    <span class="p">)</span>
    <span class="c1"># update in case we want to resume with different scheduler</span>
    <span class="k">if</span> <span class="n">scheduler_config</span> <span class="o">!=</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span>
        <span class="n">hparams</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">scheduler_config</span><span class="o">.</span><span class="n">dict</span><span class="p">())</span>

    <span class="n">model</span> <span class="o">=</span> <span class="n">model_class</span><span class="o">.</span><span class="n">load_from_checkpoint</span><span class="p">(</span><span class="n">checkpoint_path</span><span class="o">=</span><span class="n">checkpoint</span><span class="p">,</span> <span class="o">**</span><span class="n">hparams</span><span class="p">)</span>
    <span class="n">log_schedulers</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">model</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="zamba.models.model_manager.train_model" class="doc doc-heading">
<code class="highlight language-python"><span class="n">train_model</span><span class="p">(</span><span class="n">train_config</span><span class="p">:</span> <span class="n">TrainConfig</span><span class="p">,</span> <span class="n">video_loader_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">VideoLoaderConfig</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span></code>

<a href="#zamba.models.model_manager.train_model" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Trains a model.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>train_config</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="zamba.models.config.TrainConfig" href="../models-config/#zamba.models.config.TrainConfig">TrainConfig</a></code>
          </td>
          <td><p>Pydantic config for training.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>video_loader_config</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="zamba.data.video.VideoLoaderConfig" href="../data-video/#zamba.data.video.VideoLoaderConfig">VideoLoaderConfig</a></code>
          </td>
          <td><p>Pydantic config for preprocessing videos.
If None, will use default for model specified in TrainConfig.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>zamba/models/model_manager.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">train_model</span><span class="p">(</span>
    <span class="n">train_config</span><span class="p">:</span> <span class="n">TrainConfig</span><span class="p">,</span>
    <span class="n">video_loader_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">VideoLoaderConfig</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Trains a model.</span>

<span class="sd">    Args:</span>
<span class="sd">        train_config (TrainConfig): Pydantic config for training.</span>
<span class="sd">        video_loader_config (VideoLoaderConfig, optional): Pydantic config for preprocessing videos.</span>
<span class="sd">            If None, will use default for model specified in TrainConfig.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># get default VLC for model if not specified</span>
    <span class="k">if</span> <span class="n">video_loader_config</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">video_loader_config</span> <span class="o">=</span> <span class="n">ModelConfig</span><span class="p">(</span>
            <span class="n">train_config</span><span class="o">=</span><span class="n">train_config</span><span class="p">,</span> <span class="n">video_loader_config</span><span class="o">=</span><span class="n">video_loader_config</span>
        <span class="p">)</span><span class="o">.</span><span class="n">video_loader_config</span>

    <span class="c1"># set up model</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">instantiate_model</span><span class="p">(</span>
        <span class="n">checkpoint</span><span class="o">=</span><span class="n">train_config</span><span class="o">.</span><span class="n">checkpoint</span><span class="p">,</span>
        <span class="n">labels</span><span class="o">=</span><span class="n">train_config</span><span class="o">.</span><span class="n">labels</span><span class="p">,</span>
        <span class="n">scheduler_config</span><span class="o">=</span><span class="n">train_config</span><span class="o">.</span><span class="n">scheduler_config</span><span class="p">,</span>
        <span class="n">from_scratch</span><span class="o">=</span><span class="n">train_config</span><span class="o">.</span><span class="n">from_scratch</span><span class="p">,</span>
        <span class="n">model_name</span><span class="o">=</span><span class="n">train_config</span><span class="o">.</span><span class="n">model_name</span><span class="p">,</span>
        <span class="n">use_default_model_labels</span><span class="o">=</span><span class="n">train_config</span><span class="o">.</span><span class="n">use_default_model_labels</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">data_module</span> <span class="o">=</span> <span class="n">ZambaDataModule</span><span class="p">(</span>
        <span class="n">video_loader_config</span><span class="o">=</span><span class="n">video_loader_config</span><span class="p">,</span>
        <span class="n">transform</span><span class="o">=</span><span class="n">MODEL_MAPPING</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">][</span><span class="s2">&quot;transform&quot;</span><span class="p">],</span>
        <span class="n">train_metadata</span><span class="o">=</span><span class="n">train_config</span><span class="o">.</span><span class="n">labels</span><span class="p">,</span>
        <span class="n">batch_size</span><span class="o">=</span><span class="n">train_config</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span>
        <span class="n">num_workers</span><span class="o">=</span><span class="n">train_config</span><span class="o">.</span><span class="n">num_workers</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">validate_species</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data_module</span><span class="p">)</span>

    <span class="n">train_config</span><span class="o">.</span><span class="n">save_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># add folder version_n that auto increments if we are not overwriting</span>
    <span class="n">tensorboard_version</span> <span class="o">=</span> <span class="n">train_config</span><span class="o">.</span><span class="n">save_dir</span><span class="o">.</span><span class="n">name</span> <span class="k">if</span> <span class="n">train_config</span><span class="o">.</span><span class="n">overwrite</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="n">tensorboard_save_dir</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">train_config</span><span class="o">.</span><span class="n">save_dir</span><span class="o">.</span><span class="n">parent</span> <span class="k">if</span> <span class="n">train_config</span><span class="o">.</span><span class="n">overwrite</span> <span class="k">else</span> <span class="n">train_config</span><span class="o">.</span><span class="n">save_dir</span>
    <span class="p">)</span>

    <span class="n">tensorboard_logger</span> <span class="o">=</span> <span class="n">TensorBoardLogger</span><span class="p">(</span>
        <span class="n">save_dir</span><span class="o">=</span><span class="n">tensorboard_save_dir</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">version</span><span class="o">=</span><span class="n">tensorboard_version</span><span class="p">,</span>
        <span class="n">default_hp_metric</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">logging_and_save_dir</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">tensorboard_logger</span><span class="o">.</span><span class="n">log_dir</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">train_config</span><span class="o">.</span><span class="n">overwrite</span> <span class="k">else</span> <span class="n">train_config</span><span class="o">.</span><span class="n">save_dir</span>
    <span class="p">)</span>

    <span class="n">model_checkpoint</span> <span class="o">=</span> <span class="n">ModelCheckpoint</span><span class="p">(</span>
        <span class="n">dirpath</span><span class="o">=</span><span class="n">logging_and_save_dir</span><span class="p">,</span>
        <span class="n">filename</span><span class="o">=</span><span class="n">train_config</span><span class="o">.</span><span class="n">model_name</span><span class="p">,</span>
        <span class="n">monitor</span><span class="o">=</span><span class="n">train_config</span><span class="o">.</span><span class="n">early_stopping_config</span><span class="o">.</span><span class="n">monitor</span>
        <span class="k">if</span> <span class="n">train_config</span><span class="o">.</span><span class="n">early_stopping_config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">mode</span><span class="o">=</span><span class="n">train_config</span><span class="o">.</span><span class="n">early_stopping_config</span><span class="o">.</span><span class="n">mode</span>
        <span class="k">if</span> <span class="n">train_config</span><span class="o">.</span><span class="n">early_stopping_config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">else</span> <span class="s2">&quot;min&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">callbacks</span> <span class="o">=</span> <span class="p">[</span><span class="n">model_checkpoint</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">train_config</span><span class="o">.</span><span class="n">early_stopping_config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">callbacks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">EarlyStopping</span><span class="p">(</span><span class="o">**</span><span class="n">train_config</span><span class="o">.</span><span class="n">early_stopping_config</span><span class="o">.</span><span class="n">dict</span><span class="p">()))</span>

    <span class="k">if</span> <span class="n">train_config</span><span class="o">.</span><span class="n">backbone_finetune_config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">callbacks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">BackboneFinetuning</span><span class="p">(</span><span class="o">**</span><span class="n">train_config</span><span class="o">.</span><span class="n">backbone_finetune_config</span><span class="o">.</span><span class="n">dict</span><span class="p">()))</span>

    <span class="n">trainer</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">Trainer</span><span class="p">(</span>
        <span class="n">gpus</span><span class="o">=</span><span class="n">train_config</span><span class="o">.</span><span class="n">gpus</span><span class="p">,</span>
        <span class="n">max_epochs</span><span class="o">=</span><span class="n">train_config</span><span class="o">.</span><span class="n">max_epochs</span><span class="p">,</span>
        <span class="n">auto_lr_find</span><span class="o">=</span><span class="n">train_config</span><span class="o">.</span><span class="n">auto_lr_find</span><span class="p">,</span>
        <span class="n">logger</span><span class="o">=</span><span class="n">tensorboard_logger</span><span class="p">,</span>
        <span class="n">callbacks</span><span class="o">=</span><span class="n">callbacks</span><span class="p">,</span>
        <span class="n">fast_dev_run</span><span class="o">=</span><span class="n">train_config</span><span class="o">.</span><span class="n">dry_run</span><span class="p">,</span>
        <span class="n">strategy</span><span class="o">=</span><span class="n">DDPStrategy</span><span class="p">(</span><span class="n">find_unused_parameters</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">data_module</span><span class="o">.</span><span class="n">multiprocessing_context</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">video_loader_config</span><span class="o">.</span><span class="n">cache_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No cache dir is specified. Videos will not be cached.&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Videos will be cached to </span><span class="si">{</span><span class="n">video_loader_config</span><span class="o">.</span><span class="n">cache_dir</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">train_config</span><span class="o">.</span><span class="n">auto_lr_find</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Finding best learning rate.&quot;</span><span class="p">)</span>
        <span class="n">trainer</span><span class="o">.</span><span class="n">tune</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data_module</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">git_hash</span> <span class="o">=</span> <span class="n">git</span><span class="o">.</span><span class="n">Repo</span><span class="p">(</span><span class="n">search_parent_directories</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">hexsha</span>
    <span class="k">except</span> <span class="n">git</span><span class="o">.</span><span class="n">exc</span><span class="o">.</span><span class="n">InvalidGitRepositoryError</span><span class="p">:</span>
        <span class="n">git_hash</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">configuration</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;git_hash&quot;</span><span class="p">:</span> <span class="n">git_hash</span><span class="p">,</span>
        <span class="s2">&quot;model_class&quot;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">model_class</span><span class="p">,</span>
        <span class="s2">&quot;species&quot;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="p">,</span>
        <span class="s2">&quot;starting_learning_rate&quot;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">lr</span><span class="p">,</span>
        <span class="s2">&quot;train_config&quot;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">train_config</span><span class="o">.</span><span class="n">json</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;labels&quot;</span><span class="p">})),</span>
        <span class="s2">&quot;training_start_time&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
        <span class="s2">&quot;video_loader_config&quot;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">video_loader_config</span><span class="o">.</span><span class="n">json</span><span class="p">()),</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">train_config</span><span class="o">.</span><span class="n">dry_run</span><span class="p">:</span>
        <span class="n">config_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">logging_and_save_dir</span><span class="p">)</span> <span class="o">/</span> <span class="s2">&quot;train_configuration.yaml&quot;</span>
        <span class="n">config_path</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Writing out full configuration to </span><span class="si">{</span><span class="n">config_path</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">config_path</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">configuration</span><span class="p">,</span> <span class="n">fp</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting training...&quot;</span><span class="p">)</span>
    <span class="n">trainer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data_module</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">train_config</span><span class="o">.</span><span class="n">dry_run</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">trainer</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">test_dataloader</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Calculating metrics on holdout set.&quot;</span><span class="p">)</span>
            <span class="n">test_metrics</span> <span class="o">=</span> <span class="n">trainer</span><span class="o">.</span><span class="n">test</span><span class="p">(</span>
                <span class="n">dataloaders</span><span class="o">=</span><span class="n">trainer</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">test_dataloader</span><span class="p">(),</span> <span class="n">ckpt_path</span><span class="o">=</span><span class="s2">&quot;best&quot;</span>
            <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">with</span> <span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">logging_and_save_dir</span><span class="p">)</span> <span class="o">/</span> <span class="s2">&quot;test_metrics.json&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
                <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">test_metrics</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">trainer</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">val_dataloader</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Calculating metrics on validation set.&quot;</span><span class="p">)</span>
            <span class="n">val_metrics</span> <span class="o">=</span> <span class="n">trainer</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span>
                <span class="n">dataloaders</span><span class="o">=</span><span class="n">trainer</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">val_dataloader</span><span class="p">(),</span> <span class="n">ckpt_path</span><span class="o">=</span><span class="s2">&quot;best&quot;</span>
            <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">with</span> <span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">logging_and_save_dir</span><span class="p">)</span> <span class="o">/</span> <span class="s2">&quot;val_metrics.json&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
                <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">val_metrics</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">trainer</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="zamba.models.model_manager.validate_species" class="doc doc-heading">
<code class="highlight language-python"><span class="n">validate_species</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">ZambaVideoClassificationLightningModule</span><span class="p">,</span> <span class="n">data_module</span><span class="p">:</span> <span class="n">ZambaDataModule</span><span class="p">)</span></code>

<a href="#zamba.models.model_manager.validate_species" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>zamba/models/model_manager.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">validate_species</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">ZambaVideoClassificationLightningModule</span><span class="p">,</span> <span class="n">data_module</span><span class="p">:</span> <span class="n">ZambaDataModule</span><span class="p">):</span>
    <span class="n">conflicts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">dataloader_name</span><span class="p">,</span> <span class="n">dataloader</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
        <span class="p">(</span><span class="s2">&quot;Train&quot;</span><span class="p">,</span> <span class="s2">&quot;Val&quot;</span><span class="p">,</span> <span class="s2">&quot;Test&quot;</span><span class="p">),</span>
        <span class="p">(</span>
            <span class="n">data_module</span><span class="o">.</span><span class="n">train_dataloader</span><span class="p">(),</span>
            <span class="n">data_module</span><span class="o">.</span><span class="n">val_dataloader</span><span class="p">(),</span>
            <span class="n">data_module</span><span class="o">.</span><span class="n">test_dataloader</span><span class="p">(),</span>
        <span class="p">),</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">dataloader</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">dataloader</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">species</span> <span class="o">!=</span> <span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="p">):</span>
            <span class="n">conflicts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span><span class="si">{</span><span class="n">dataloader_name</span><span class="si">}</span><span class="s2"> dataset includes:</span><span class="se">\n</span><span class="si">{</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dataloader</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">species</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span>
            <span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">conflicts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">conflicts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;Model predicts:</span><span class="se">\n</span><span class="si">{</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>

        <span class="n">conflict_msg</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">conflicts</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Dataloader species and model species do not match.</span><span class="se">\n\n</span><span class="si">{</span><span class="n">conflict_msg</span><span class="si">}</span><span class="s2">&quot;&quot;&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../models-efficientnet_models/" class="md-footer__link md-footer__link--prev" aria-label="Previous: zamba.models.efficientnet_models" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              zamba.models.efficientnet_models
            </div>
          </div>
        </a>
      
      
        
        <a href="../models-slowfast_models/" class="md-footer__link md-footer__link--next" aria-label="Next: zamba.models.slowfast_models" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              zamba.models.slowfast_models
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.indexes", "navigation.sections"], "search": "../../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.8492ddcf.min.js"></script>
      
    
  </body>
</html>